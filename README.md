# CloudFunctionsでのスクレイピングをGASで管理
## 概要
Googleドライブ上に置いたjsonファイルをもとにCloudFunctions上にデプロイしたPythonアプリでスクレイピングを行い、そこで取得したデータを受け取ってGoogleドライブ上のスプレッドシートに格納します。その際の定期実行とシートの管理とエラーの通知を行うためのミドルウェアです。
## 使用ライブラリ
[RunAll](https://github.com/tanaikech/RunAll)<br>
元々が`UrlFetchApp.fetchAll`メソッドであるため、GCPのアクセスを引数として渡す、メールでのエラー通知のためのエラーハンドリングをthrowで行うなどの工夫が必要です。
## 機能
- JSONファイルに必要事項を記入し特定のフォルダに配置することで、JSONを参照してCloudFunctions上でのスクレイピングを実行します。
- スクレイピングによって取得したデータをスプレッドシートに格納します。
- サイトによって定期実行を行うかどうかを時間帯で分岐させることができます。
- キー番号を管理するスプレッドシートを作成しておくことで、データベースの主キーとしてidを使う場合に相当する一意のキー番号が自動で挿入されます。
- 並列処理を行うためスクレイピングに失敗した場合でも他のサイトに影響が出ることがありません。
- エラーが生じた場合、並列処理のうちエラーが発生した処理の個数が集計され通知されます。
